--- ntrack-013.org/configure.ac	2011-03-27 19:59:12.000000000 +0200
+++ ntrack-013/configure.ac	2011-03-27 23:25:44.112838906 +0200
@@ -139,6 +142,11 @@
 
 AM_CONDITIONAL(HAVE_QT4, test $ac_have_qt4 = 1)
 
+PKG_CHECK_MODULES(LIBNL3, libnl-3.0, ac_have_libnl3=1, ac_have_libnl3=0)
+AC_SUBST(LIBNL3_CFLAGS)
+AC_SUBST(LIBNL3_LIBS)
+AM_CONDITIONAL(HAVE_LIBNL3, test $ac_have_libnl3 = 1)
+
 PKG_CHECK_MODULES(LIBNL2, libnl-2.0, ac_have_libnl2=1, ac_have_libnl2=0)
 AC_SUBST(LIBNL2_CFLAGS)
 AC_SUBST(LIBNL2_LIBS)
@@ -150,7 +158,7 @@
 AM_CONDITIONAL(HAVE_LIBNL1, test $ac_have_libnl1 = 1)
 
 # consistency checks
-if ! test "$ac_have_libnl1" = "1" -o "$ac_have_libnl2" = 1; then
+if ! test "$ac_have_libnl1" = "1" -o "$ac_have_libnl2" = 1 -o "$ac_have_libnl3" = 1; then
 	AC_ERROR([libnl is required])
 fi
 
--- ntrack-013/modules/Makefile.am~	2010-12-22 23:47:45.000000000 +0100
+++ ntrack-013/modules/Makefile.am	2011-03-27 23:28:09.316142639 +0200
@@ -36,8 +36,11 @@
 if HAVE_LIBNL2
 NTRACK_LIB2 = ntrack-libnl2.la
 endif
+if HAVE_LIBNL3
+NTRACK_LIB3 = ntrack-libnl3.la
+endif
 
-ntrackmodules_LTLIBRARIES = $(NTRACK_LIB1) $(NTRACK_LIB2)
+ntrackmodules_LTLIBRARIES = $(NTRACK_LIB1) $(NTRACK_LIB2) $(NTRACK_LIB3)
 
 if HAVE_LIBNL1
 ntrack_libnl1_la_SOURCES = \
@@ -57,3 +60,12 @@
 ntrack_libnl2_la_LDFLAGS = -module -avoid-version
 endif
 
+if HAVE_LIBNL3
+ntrack_libnl3_la_SOURCES = \
+	ntrack-libnl.c \
+	$(top_srcdir)/common/ntrackarchapi.h
+ntrack_libnl3_la_CFLAGS = $(AM_CFLAGS) $(LIBNL3_CFLAGS) -DHAVE_LIBNL2 -DHAVE_LIBNL3
+ntrack_libnl3_la_LIBADD = $(LIBNL3_LIBS) ../common/libntrack.la
+ntrack_libnl3_la_LDFLAGS = -module -avoid-version
+endif
+
